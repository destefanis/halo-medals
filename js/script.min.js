(function(a){function q(){m=a("#gamertag-field").val();h=a("#gamertag-field").val().replace(/ +/g,"+").trim();a(".description-box").addClass("is-visible");a(".description-box__name").html("Status");a(".description-box__description").html("Searching for recent matches.");r=a(".select").val();if(""===a("#gamertag-field").val())a(".description-box__name").html("Error"),a(".description-box__description").html("Gamertag field empty! Enter your gamertag and try again.");else{k();var b;b=window.location.href;
var c=h,e=/\b(gamertag=).*?(&|$)/;b=0<=b.search(e)?b.replace(e,"$1"+c+"$2"):b+(0<b.indexOf("?")?"&":"?")+"gamertag="+c;window.history.pushState(b,"Title",b);a(".preloader__background").addClass("is--loading")}jQuery.isEmptyObject(n)&&v();jQuery.isEmptyObject(l)&&w()}function k(){a.ajax({url:"https://www.haloapi.com/metadata/h5/metadata/maps",beforeSend:function(a){a.setRequestHeader("Ocp-Apim-Subscription-Key","adb9ae6a4e454200ac1d1093af6b29f1")},type:"GET",dataType:"json",success:function(a){x(a)}})}
function x(b){a.ajax({url:"https://www.haloapi.com/metadata/h5/metadata/medals",beforeSend:function(a){a.setRequestHeader("Ocp-Apim-Subscription-Key","adb9ae6a4e454200ac1d1093af6b29f1")},type:"GET",dataType:"json",success:function(a){y(b,a)}})}function v(){a.ajax({url:"https://www.haloapi.com/metadata/h5/metadata/weapons",beforeSend:function(a){a.setRequestHeader("Ocp-Apim-Subscription-Key","adb9ae6a4e454200ac1d1093af6b29f1")},type:"GET",dataType:"json",success:function(a){n=a}})}function w(){a.ajax({url:"https://www.haloapi.com/metadata/h5/metadata/csr-designations",
beforeSend:function(a){a.setRequestHeader("Ocp-Apim-Subscription-Key","adb9ae6a4e454200ac1d1093af6b29f1")},type:"GET",dataType:"json",success:function(a){l=a},statusCode:{429:function(){a(".description-box__name").html("Error");a(".description-box__description").html("Maxmium API calls reached due to traffic. Please try again in 10 seconds.");a(".preloader__background").removeClass("is--loading")}}})}function y(b,c){a.ajax({url:"https://www.haloapi.com/stats/h5/players/"+h+"/matches?modes="+r+"&start="+
p+"&count=3",beforeSend:function(a){a.setRequestHeader("Ocp-Apim-Subscription-Key","adb9ae6a4e454200ac1d1093af6b29f1")},type:"GET",dataType:"json",success:function(e){z(e,b,c);p+=3;a(".description-box").addClass("is-loading");a(".description-box__name").html("Success");a(".description-box__description").html("Recent Matches Found")},statusCode:{429:function(){a(".description-box__name").html("Error");a(".description-box__description").html("Maxmium API calls reached due to traffic. Please try again in 10 seconds.");
a(".preloader__background").removeClass("is--loading")}}}).fail(function(){a(".description-box__name").html("Error");a(".description-box__description").html("The attempt to fetch recent matches wasn't successful, please try again.");a(".preloader__background").removeClass("is--loading")})}function z(b,c,e){a.each(b.Results,function(){var a=this.Id.MatchId,b=this.Id.GameMode,d=this.MatchCompletedDate.ISO8601Date;1===b?b="arena":4===b&&(b="warzone");A(a,c,e,b,d)})}function A(b,c,e,f,g){a.ajax({url:"https://www.haloapi.com/stats/h5/"+
f+"/matches/"+b,beforeSend:function(a){a.setRequestHeader("Ocp-Apim-Subscription-Key","adb9ae6a4e454200ac1d1093af6b29f1")},type:"GET",dataType:"json",success:function(d){var B=d.MapId,h=[],k=[];a.each(c,function(){if(B===this.id){d.MapName=this.name;d.MatchType=f;d.MatchImage=this.imageUrl;d.id=b;var c=d.TotalDuration.replace("PT","").replace("H",":").replace("M","MIN ");d.MatchLength=c.substring(0,c.indexOf("."))+"SEC";c=g.substring(0,g.indexOf("T")).substring(5);d.DateStamp=c.replace(/^0+/,"").replace("-",
"/");a.each(d.PlayerStats,function(b,c){var C=this.Player.Gamertag.toLowerCase(),e=m.toLowerCase(),t=(c.TotalSpartanKills+c.TotalAssists)/c.TotalDeaths,D=Math.round(100*t)/100,f=parseFloat(c.TotalGroundPoundDamage+c.TotalWeaponDamage+c.TotalMeleeDamage+c.TotalGrenadeDamage+c.TotalPowerWeaponDamage);c.TotalDamage=f.toFixed();c.TotalAccuracy=Math.round(c.TotalShotsLanded/c.TotalShotsFired*100);isNaN(D)?c.KDASpread="N/A":c.KDASpread=Math.round(100*t)/100;null!=c.PreviousCsr&&a.each(l,function(b,d){d.id==
c.PreviousCsr.DesignationId&&(c.PreviousRankTitle=d.name,a.each(d.tiers,function(a,b){b.id==c.PreviousCsr.Tier&&(c.PreviousCSRIcon=b.iconImageUrl)}))});this.Player.Gamertag===m?d.player=this:C===e?d.player=this:(a(".description-box").removeClass("is-loading"),a(".description-box__name").html("Error"),a(".description-box__description").html("There's an issue with your Gamertag, make sure it's entered correclty and try again."))});h.push(d)}});a.each(h,function(b,c){var f=_.template(a("#match-card").html()),
g=0,h=0;c.player.TotalXPEarned=c.player.XpInfo.TotalXP-c.player.XpInfo.PrevTotalXP;1!=d.player.DNF?a.each(d.TeamStats,function(a,b){b.Score>g&&(g=b.Score,h=b.TeamId,d.player.MatchStatus=d.player.TeamId===h?"Victory":"Defeat")}):d.player.MatchStatus="DNF";a.each(n,function(a,b){if(b.id==c.player.WeaponWithMostKills.WeaponId.StockId)return c.player.WeaponWithMostKills.WeaponName=b.name,c.player.WeaponWithMostKills.WeaponURL=b.smallIconImageUrl,!1});null!=c.player.CurrentCsr&&a.each(l,function(b,d){d.id==
c.player.CurrentCsr.DesignationId&&(c.player.CurrentRankTitle=d.name,a.each(d.tiers,function(a,b){b.id==c.player.CurrentCsr.Tier&&(c.player.CurrentCSRIcon=b.iconImageUrl)}))});a(".page__controls").addClass("is-visible");a.each(d.player.MedalAwards,function(a,b){var c=_.findWhere(e,{id:b.MedalId.toString()});c.count=b.Count;k.push(c)});c.medalsEarned=k;"c7edbf0f-f206-11e4-aa52-24be05e24f7e"===c.MapId?a.ajax({url:"https://www.haloapi.com/metadata/h5/metadata/map-variants/"+c.MapVariantId,beforeSend:function(a){a.setRequestHeader("Ocp-Apim-Subscription-Key",
"adb9ae6a4e454200ac1d1093af6b29f1")},type:"GET",dataType:"json",success:function(b){c.Name=b.name;a("#recent-matches").append(f({match:c}));u(c)}}):(c.Name=c.MapName,a("#recent-matches").append(f({match:c})));"arena"===c.MatchType&&u(c)});a(".description-box").removeClass("is-visible is-loading");a(".preloader__background").removeClass("is--loading");a(".button--load-more").removeClass("is--loading-button")},statusCode:{429:function(){a(".description-box__name").html("Error");a(".description-box__description").html("Maxmium API calls reached due to traffic. Please try again in 10 seconds.");
a(".preloader__background").removeClass("is--loading")}}})}function u(b){var c,e,f,g,d="#report-"+b.id;null===b.player.PreviousCsr&&-1<b.player.MeasurementMatchesLeft?(a(d).find(".progress-stats__number").html(b.player.MeasurementMatchesLeft),a(d).find(".report__header--rank").text("Placement Matches Left:")):6===b.player.CurrentCsr.DesignationId?(a(d+" #previous-rank-circle").addClass("no-graph"),a(d).find(".progress-stats__number").html(b.player.CurrentCsr.Csr),a(d).find(".report__header--rank-title").text(b.player.PreviousCsr.Csr+
" "+b.player.CurrentRankTitle)):7===b.player.CurrentCsr.DesignationId?(a(d+" #previous-rank-circle").addClass("no-graph"),a(d).find(".progress-stats__number").html(b.player.CurrentCsr.Rank),a(d).find(".report__header--rank-title").text(b.player.CurrentRankTitle+" "+b.player.PreviousCsr.Rank)):b.player.CurrentCsr.PercentToNextTier<b.player.PreviousCsr.PercentToNextTier&&b.player.CurrentCsr.Tier>b.player.PreviousCsr.Tier?(c=b.player.PreviousCsr.PercentToNextTier/100,e=b.player.CurrentCsr.PercentToNextTier/
100,g=3.6*b.player.PreviousCsr.PercentToNextTier,d="#report-"+b.id,a("#report-"+b.id+" #previous-rank-circle").circleProgress({startAngle:-Math.PI/2+.01745*g,emptyFill:"rgba(90, 90, 102, 1)",value:1-c,size:80,thickness:4,fill:{gradient:["#85F7D3","#5DFDCB"]}}),a(d+" #previous-rank-circle").on("circle-animation-end",function(f){a(d).find(".progress-stats__number").html("+"+parseInt(100*(1-c+e))+"%");a(d).find(".report__header--rank-title").text(b.player.CurrentRankTitle+" "+b.player.PreviousCsr.Tier+
" (RANK UP!)")})):b.player.CurrentCsr.PercentToNextTier>b.player.PreviousCsr.PercentToNextTier&&b.player.CurrentCsr.Tier===b.player.PreviousCsr.Tier?(c=b.player.CurrentCsr.PercentToNextTier/100,f=b.player.PreviousCsr.PercentToNextTier/100,g=3.6*b.player.PreviousCsr.PercentToNextTier,a(d+" #previous-rank-circle").circleProgress({startAngle:-Math.PI/2,value:c,emptyFill:"rgba(255, 255, 255, 1)",size:80,thickness:4,fill:{gradient:["#85F7D3","#5DFDCB"]}}),a(d+" #previous-rank-circle").on("circle-animation-end",
function(e){a(d).find(".progress-stats__number").html("+"+parseInt(100*(c-f))+"%");a(d).find(".report__header--rank-title").text(b.player.CurrentRankTitle+" "+b.player.CurrentCsr.Tier)})):b.player.CurrentCsr.PercentToNextTier<b.player.PreviousCsr.PercentToNextTier&&b.player.CurrentCsr.Tier<=b.player.PreviousCsr.Tier?(c=b.player.CurrentCsr.PercentToNextTier/100,f=b.player.PreviousCsr.PercentToNextTier/100,g=3.6*b.player.PreviousCsr.PercentToNextTier,a(d+" #previous-rank-circle").circleProgress({startAngle:-Math.PI/
2+.01745*g,value:c,reverse:!0,size:80,thickness:4,fill:{color:"#F06449"}}),a("#report-"+b.id+" #previous-rank-circle").on("circle-animation-end",function(e){a("#report-"+b.id).find(".progress-stats__number").html("-"+parseInt(100*(f-c))+"%");a(d).find(".report__header--rank-title").text(b.player.CurrentRankTitle+" "+b.player.CurrentCsr.Tier)})):b.player.CurrentCsr.PercentToNextTier>b.player.PreviousCsr.PercentToNextTier&&b.player.CurrentCsr.Tier<b.player.PreviousCsr.Tier&&(c=b.player.CurrentCsr.PercentToNextTier/
100,f=b.player.PreviousCsr.PercentToNextTier/100,g=3.6*b.player.PreviousCsr.PercentToNextTier,a("#report-"+b.id+" #previous-rank-circle").circleProgress({startAngle:-Math.PI/2,value:c,size:80,thickness:4,emptyFill:"rgba(240, 100, 73, 1)",fill:{color:"#5A5A66"}}),a("#report-"+b.id+" #previous-rank-circle").on("circle-animation-end",function(e){a("#report-"+b.id).find(".progress-stats__number").html("-"+parseInt(100*(1-c+f))+"%");a(d).find(".report__header--rank-title").text(b.player.PreviousRankTitle+
" "+b.player.PreviousCsr.Tier)}))}var m="",h="",r="",n={},l={},p=0;a(".js-button").click(function(a){a.preventDefault();q()});a(".input-field").keypress(function(a){if(13==a.which)return q(),!1});a(".button--load-more").click(function(b){b.preventDefault();k();a(".preloader__background").addClass("is--loading");a(this).addClass("is--loading-button")});a(".button--reset").click(function(b){b.preventDefault();p=0;a(".recent-matches").empty();a(".page__controls").removeClass("is-visible");k();a(".description-box").addClass("is-visible");
a(".description-box__name").html("Status");a(".description-box__description").html("Searching for recent matches.");a(".preloader__background").addClass("is--loading")});a("#recent-matches").delegate(".match-card","click",function(){a(this).toggleClass("medals-visible");a(this).next(".match-card__report").toggleClass("is-visible");a(".description-box").removeClass("is-visible")});a("#recent-matches").delegate(".close-button","click",function(){a(this).closest(".match-card__report").removeClass("is-visible");
a(this).closest(".match-card__report").prev(".match-card").removeClass("medals-visible");a(".description-box").removeClass("is-visible")});a("#recent-matches").delegate(".medal-list__item","click",function(){var b=a(this).find(".medal-content").attr("data-description"),c=a(this).find(".medal-content").attr("data-name");a(".description-box").addClass("is-visible");a(".description-box__name").html(c);a(".description-box__description").html(b)});a(".message-close").click(function(){a(".description-box").removeClass("is-visible")});
a(".link--with-popup").magnificPopup({type:"inline",fixedContentPos:!1,fixedBgPos:!0,overflowY:"auto",closeBtnInside:!0,preloader:!1,midClick:!0,removalDelay:300,mainClass:"my-mfp-zoom-in"});a("#recent-matches").delegate(".detail__list-item","click",function(){a(this).toggleClass("is-visible")});a("#recent-matches").delegate(".team-list__toggle","click",function(){a(this).hasClass("team--is-visible")?(a(this).toggleClass("team--is-visible"),a(this).text("Show"),a(this).parent().next(".team__table").hide()):
(a(this).toggleClass("team--is-visible"),a(this).text("Hide"),a(this).parent().next(".team__table").show())});window.onload=function(){var b;a:{b=decodeURIComponent(window.location.search.substring(1)).split("&");var c,e;for(e=0;e<b.length;e++)if(c=b[e].split("="),"gamertag"===c[0]){b=void 0===c[1]?!0:c[1];break a}b=void 0}void 0!=b?(b=b.replace(/\+/g," "),a(".input-field").val(b)):"gamertag"!=sessionStorage.getItem("gamertag")&&(b=sessionStorage.getItem("gamertag"),null!==b&&a(".input-field").val(b))};
window.onbeforeunload=function(){sessionStorage.setItem("gamertag",a(".input-field").val())}})(jQuery);
