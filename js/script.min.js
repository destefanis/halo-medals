!function(e){"use strict";function r(){if(p=e("#gamertag-field").val(),u=e("#gamertag-field").val().replace(/ +/g,"+").trim(),e(".description-box").addClass("is-visible"),e(".description-box__name").html("Status"),e(".description-box__description").html("Searching for recent matches."),m=e(".select").val(),""===e("#gamertag-field").val())e(".description-box__name").html("Error"),e(".description-box__description").html("Gamertag field empty! Enter your gamertag and try again.");else{t();var r=window.location.href,a=d(r,"gamertag",u);window.history.pushState(a,"Title",a),e(".preloader__background").addClass("is--loading")}jQuery.isEmptyObject(h)&&i(),jQuery.isEmptyObject(f)&&s()}function t(){e.ajax({url:"http://www.halomedals.io/json/maps.json",type:"GET",dataType:"json",success:function(e){a(e)}})}function a(r){e.ajax({url:"http://www.halomedals.io/json/medals.json",type:"GET",dataType:"json",success:function(e){n(r,e)}})}function i(){e.ajax({url:"http://www.halomedals.io/json/weapons.json",type:"GET",dataType:"json",success:function(e){h=e}})}function s(){e.jsonp({url:"https://www.haloapi.com/metadata/h5/metadata/csr-designations",beforeSend:function(e){e.setRequestHeader("Ocp-Apim-Subscription-Key","adb9ae6a4e454200ac1d1093af6b29f1")},type:"GET",dataType:"json",success:function(e){f=e},statusCode:{429:function(){e(".description-box__name").html("Error"),e(".description-box__description").html("Maxmium API calls reached due to traffic. Please try again in 10 seconds."),e(".preloader__background").removeClass("is--loading")}}})}function n(r,t){e.jsonp({url:"https://www.haloapi.com/stats/h5/players/"+u+"/matches?modes="+m+"&start="+g+"&count=3",beforeSend:function(e){e.setRequestHeader("Ocp-Apim-Subscription-Key","adb9ae6a4e454200ac1d1093af6b29f1")},type:"GET",dataType:"json",success:function(a){o(a,r,t),g+=3,e(".description-box").addClass("is-loading"),e(".description-box__name").html("Success"),e(".description-box__description").html("Recent Matches Found")},statusCode:{429:function(){e(".description-box__name").html("Error"),e(".description-box__description").html("Maxmium API calls reached due to traffic. Please try again in 10 seconds."),e(".preloader__background").removeClass("is--loading")}}}).fail(function(){e(".description-box__name").html("Error"),e(".description-box__description").html("The attempt to fetch recent matches wasn't successful, please try again."),e(".preloader__background").removeClass("is--loading")})}function o(r,t,a){e.each(r.Results,function(){var e=this.Id.MatchId,r=this.Id.GameMode,i=this.MatchCompletedDate.ISO8601Date;1===r?r="arena":4===r&&(r="warzone"),l(e,t,a,r,i)})}function l(r,t,a,i,s){e.jsonp({url:"https://www.haloapi.com/stats/h5/"+i+"/matches/"+r,beforeSend:function(e){e.setRequestHeader("Ocp-Apim-Subscription-Key","adb9ae6a4e454200ac1d1093af6b29f1")},type:"GET",dataType:"json",success:function(n){var o=n.MapId,l=a,d=[],u=[];e.each(t,function(){if(o===this.id){n.MapName=this.name,n.MatchType=i,n.MatchImage=this.imageUrl,n.id=r;var t=n.TotalDuration,a=t.replace("PT","").replace("H",":").replace("M","MIN ");n.MatchLength=a.substring(0,a.indexOf("."))+"SEC";var l=s,c=l.substring(0,l.indexOf("T")),u=c.substring(5);n.DateStamp=u.replace(/^0+/,"").replace("-","/"),e.each(n.PlayerStats,function(r,t){var a=this.Player.Gamertag.toLowerCase(),i=p.toLowerCase(),s=(t.TotalSpartanKills+t.TotalAssists)/t.TotalDeaths,o=Math.round(100*s)/100,l=parseFloat(t.TotalGroundPoundDamage+t.TotalWeaponDamage+t.TotalMeleeDamage+t.TotalGrenadeDamage+t.TotalPowerWeaponDamage);t.TotalDamage=l.toFixed();var c=Math.round(t.TotalShotsLanded/t.TotalShotsFired*100);t.TotalAccuracy=c,isNaN(o)?t.KDASpread="N/A":t.KDASpread=Math.round(100*s)/100,null!=t.PreviousCsr&&e.each(f,function(r,a){a.id==t.PreviousCsr.DesignationId&&(t.PreviousRankTitle=a.name,e.each(a.tiers,function(e,r){return r.id==t.PreviousCsr.Tier?void(t.PreviousCSRIcon=r.iconImageUrl):void 0}))}),this.Player.Gamertag===p?n.player=this:a===i?n.player=this:(e(".description-box").removeClass("is-loading"),e(".description-box__name").html("Error"),e(".description-box__description").html("There's an issue with your Gamertag, make sure it's entered correclty and try again."))}),d.push(n)}}),e.each(d,function(r,t){var a=_.template(e("#match-card").html()),i=0,s=0;t.player.TotalXPEarned=t.player.XpInfo.TotalXP-t.player.XpInfo.PrevTotalXP,1!=n.player.DNF?e.each(n.TeamStats,function(e,r){r.Score>i&&(i=r.Score,s=r.TeamId,n.player.TeamId===s?n.player.MatchStatus="Victory":n.player.MatchStatus="Defeat")}):n.player.MatchStatus="DNF",e.each(h,function(e,r){return r.id==t.player.WeaponWithMostKills.WeaponId.StockId?(t.player.WeaponWithMostKills.WeaponName=r.name,t.player.WeaponWithMostKills.WeaponURL=r.smallIconImageUrl,!1):void 0}),null!=t.player.CurrentCsr&&e.each(f,function(r,a){a.id==t.player.CurrentCsr.DesignationId&&(t.player.CurrentRankTitle=a.name,e.each(a.tiers,function(e,r){r.id==t.player.CurrentCsr.Tier&&(t.player.CurrentCSRIcon=r.iconImageUrl)}))}),e(".page__controls").addClass("is-visible"),e.each(n.player.MedalAwards,function(e,r){var t=r.MedalId,a=t.toString(),i=_.findWhere(l,{id:a});i.count=r.Count,u.push(i)}),t.medalsEarned=u,"c7edbf0f-f206-11e4-aa52-24be05e24f7e"===t.MapId?e.jsonp({url:"https://www.haloapi.com/metadata/h5/metadata/map-variants/"+t.MapVariantId,beforeSend:function(e){e.setRequestHeader("Ocp-Apim-Subscription-Key","adb9ae6a4e454200ac1d1093af6b29f1")},type:"GET",dataType:"json",success:function(r){t.Name=r.name,e("#recent-matches").append(a({match:t})),c(t)}}):(t.Name=t.MapName,e("#recent-matches").append(a({match:t}))),"arena"===t.MatchType&&c(t)}),e(".description-box").removeClass("is-visible is-loading"),e(".preloader__background").removeClass("is--loading"),e(".button--load-more").removeClass("is--loading-button")},statusCode:{429:function(){e(".description-box__name").html("Error"),e(".description-box__description").html("Maxmium API calls reached due to traffic. Please try again in 10 seconds."),e(".preloader__background").removeClass("is--loading")}}})}function c(r){var t,a,i,s,n="#report-"+r.id;null===r.player.PreviousCsr&&r.player.MeasurementMatchesLeft>-1?(e(n).find(".progress-stats__number").html(r.player.MeasurementMatchesLeft),e(n).find(".report__header--rank").text("Placement Matches Left:")):6===r.player.CurrentCsr.DesignationId?(e(n+" #previous-rank-circle").addClass("no-graph"),e(n).find(".progress-stats__number").html(r.player.CurrentCsr.Csr),e(n).find(".report__header--rank-title").text(r.player.PreviousCsr.Csr+" "+r.player.CurrentRankTitle)):7===r.player.CurrentCsr.DesignationId?(e(n+" #previous-rank-circle").addClass("no-graph"),e(n).find(".progress-stats__number").html(r.player.CurrentCsr.Rank),e(n).find(".report__header--rank-title").text(r.player.CurrentRankTitle+" "+r.player.PreviousCsr.Rank)):r.player.CurrentCsr.PercentToNextTier<r.player.PreviousCsr.PercentToNextTier&&r.player.CurrentCsr.Tier>r.player.PreviousCsr.Tier?(t=r.player.PreviousCsr.PercentToNextTier/100,a=r.player.CurrentCsr.PercentToNextTier/100,s=3.6*r.player.PreviousCsr.PercentToNextTier,n="#report-"+r.id,e("#report-"+r.id+" #previous-rank-circle").circleProgress({startAngle:-Math.PI/2+.01745*s,emptyFill:"rgba(90, 90, 102, 1)",value:1-t,size:80,thickness:4,fill:{gradient:["#85F7D3","#5DFDCB"]}}),e(n+" #previous-rank-circle").on("circle-animation-end",function(i){e(n).find(".progress-stats__number").html("+"+parseInt(100*(1-t+a))+"%"),e(n).find(".report__header--rank-title").text(r.player.CurrentRankTitle+" "+r.player.PreviousCsr.Tier+" (RANK UP!)")})):r.player.CurrentCsr.PercentToNextTier>r.player.PreviousCsr.PercentToNextTier&&r.player.CurrentCsr.Tier===r.player.PreviousCsr.Tier?(t=r.player.CurrentCsr.PercentToNextTier/100,i=r.player.PreviousCsr.PercentToNextTier/100,s=3.6*r.player.PreviousCsr.PercentToNextTier,e(n+" #previous-rank-circle").circleProgress({startAngle:-Math.PI/2,value:t,emptyFill:"rgba(255, 255, 255, 1)",size:80,thickness:4,fill:{gradient:["#85F7D3","#5DFDCB"]}}),e(n+" #previous-rank-circle").on("circle-animation-end",function(a){e(n).find(".progress-stats__number").html("+"+parseInt(100*(t-i))+"%"),e(n).find(".report__header--rank-title").text(r.player.CurrentRankTitle+" "+r.player.CurrentCsr.Tier)})):r.player.CurrentCsr.PercentToNextTier<r.player.PreviousCsr.PercentToNextTier&&r.player.CurrentCsr.Tier<=r.player.PreviousCsr.Tier?(t=r.player.CurrentCsr.PercentToNextTier/100,i=r.player.PreviousCsr.PercentToNextTier/100,s=3.6*r.player.PreviousCsr.PercentToNextTier,e(n+" #previous-rank-circle").circleProgress({startAngle:-Math.PI/2+.01745*s,value:t,reverse:!0,size:80,thickness:4,fill:{color:"#F06449"}}),e("#report-"+r.id+" #previous-rank-circle").on("circle-animation-end",function(a){e("#report-"+r.id).find(".progress-stats__number").html("-"+parseInt(100*(i-t))+"%"),e(n).find(".report__header--rank-title").text(r.player.CurrentRankTitle+" "+r.player.CurrentCsr.Tier)})):r.player.CurrentCsr.PercentToNextTier>r.player.PreviousCsr.PercentToNextTier&&r.player.CurrentCsr.Tier<r.player.PreviousCsr.Tier&&(t=r.player.CurrentCsr.PercentToNextTier/100,i=r.player.PreviousCsr.PercentToNextTier/100,s=3.6*r.player.PreviousCsr.PercentToNextTier,e("#report-"+r.id+" #previous-rank-circle").circleProgress({startAngle:-Math.PI/2,value:t,size:80,thickness:4,emptyFill:"rgba(240, 100, 73, 1)",fill:{color:"#5A5A66"}}),e("#report-"+r.id+" #previous-rank-circle").on("circle-animation-end",function(a){e("#report-"+r.id).find(".progress-stats__number").html("-"+parseInt(100*(1-t+i))+"%"),e(n).find(".report__header--rank-title").text(r.player.PreviousRankTitle+" "+r.player.PreviousCsr.Tier)}))}function d(e,r,t){var a=new RegExp("\\b("+r+"=).*?(&|$)");return e.search(a)>=0?e.replace(a,"$1"+t+"$2"):e+(e.indexOf("?")>0?"&":"?")+r+"="+t}var p="",u="",m="",h={},f={},g=0;e(".js-button").click(function(e){e.preventDefault(),r()}),e(".input-field").keypress(function(e){return 13==e.which?(r(),!1):void 0}),e(".button--load-more").click(function(r){r.preventDefault(),t(),e(".preloader__background").addClass("is--loading"),e(this).addClass("is--loading-button")}),e(".button--reset").click(function(r){r.preventDefault(),g=0,e(".recent-matches").empty(),e(".page__controls").removeClass("is-visible"),t(),e(".description-box").addClass("is-visible"),e(".description-box__name").html("Status"),e(".description-box__description").html("Searching for recent matches."),e(".preloader__background").addClass("is--loading")}),e("#recent-matches").delegate(".match-card","click",function(){e(this).toggleClass("medals-visible"),e(this).next(".match-card__report").toggleClass("is-visible"),e(".description-box").removeClass("is-visible")}),e("#recent-matches").delegate(".close-button","click",function(){e(this).closest(".match-card__report").removeClass("is-visible"),e(this).closest(".match-card__report").prev(".match-card").removeClass("medals-visible"),e(".description-box").removeClass("is-visible")}),e("#recent-matches").delegate(".medal-list__item","click",function(){var r=e(this).find(".medal-content").attr("data-description"),t=e(this).find(".medal-content").attr("data-name");e(".description-box").addClass("is-visible"),e(".description-box__name").html(t),e(".description-box__description").html(r)}),e(".message-close").click(function(){e(".description-box").removeClass("is-visible")}),e(".link--with-popup").magnificPopup({type:"inline",fixedContentPos:!1,fixedBgPos:!0,overflowY:"auto",closeBtnInside:!0,preloader:!1,midClick:!0,removalDelay:300,mainClass:"my-mfp-zoom-in"}),e("#recent-matches").delegate(".detail__list-item","click",function(){e(this).toggleClass("is-visible")}),e("#recent-matches").delegate(".team-list__toggle","click",function(){e(this).hasClass("team--is-visible")?(e(this).toggleClass("team--is-visible"),e(this).text("Show"),e(this).parent().next(".team__table").hide()):(e(this).toggleClass("team--is-visible"),e(this).text("Hide"),e(this).parent().next(".team__table").show())}),window.onload=function(){var r=C("gamertag");if(void 0!=r){var t=r.replace(/\+/g," ");e(".input-field").val(t)}else{if("gamertag"==sessionStorage.getItem("gamertag"))return;var a=sessionStorage.getItem("gamertag");null!==a&&e(".input-field").val(a)}},window.onbeforeunload=function(){sessionStorage.setItem("gamertag",e(".input-field").val())};var C=function(e){var r,t,a=decodeURIComponent(window.location.search.substring(1)),i=a.split("&");for(t=0;t<i.length;t++)if(r=i[t].split("="),r[0]===e)return void 0===r[1]?!0:r[1]}}(jQuery);
