!function(e){"use strict";function a(){e.ajax({url:"http://www.halomedals.io/json/maps.json",type:"GET",dataType:"json",success:function(e){t(e)}})}function t(a){e.ajax({url:"http://www.halomedals.io/json/medals.json",type:"GET",dataType:"json",success:function(e){s(a,e)}})}function s(a,t){e.jsonp({url:"https://www.haloapi.com/stats/h5/players/"+r+"/matches?modes="+c+"&start="+d+"&count=3",beforeSend:function(e){e.setRequestHeader("Ocp-Apim-Subscription-Key","ba39bd7104bf4cdf8385f925f2e709a1")},type:"GET",dataType:"json",success:function(s){i(s,a,t),d+=3,e(".description-box").addClass("is-loading"),e(".description-box__name").html("Success"),e(".description-box__description").html("Recent Matches Found")},statusCode:{429:function(){e(".description-box__name").html("Error"),e(".description-box__description").html("Maxmium API calls reached due to traffic. Please try again in 10 seconds."),e(".preloader__background").removeClass("is--loading")}}}).fail(function(){e(".description-box__name").html("Error"),e(".description-box__description").html("The attempt to fetch recent matches wasn't successful, please try again."),e(".preloader__background").removeClass("is--loading")})}function i(a,t,s){e.each(a.Results,function(){var e=this.Id.MatchId,a=this.Id.GameMode;1===a?a="arena":4===a&&(a="warzone"),o(e,t,s,a)})}function o(a,t,s,i){e.jsonp({url:"https://www.haloapi.com/stats/h5/"+i+"/matches/"+a,beforeSend:function(e){e.setRequestHeader("Ocp-Apim-Subscription-Key","ba39bd7104bf4cdf8385f925f2e709a1")},type:"GET",dataType:"json",success:function(o){var r=o.MapId,c=s,d=[],l=[];e.each(t,function(){r===this.id&&(o.MapName=this.name,o.MatchType=i,o.MatchImage=this.imageUrl,o.id=a,e.each(o.PlayerStats,function(a,t){var s=this.Player.Gamertag.toLowerCase(),i=n.toLowerCase();this.Player.Gamertag===n?o.player=this:s===i?o.player=this:(e(".description-box").removeClass("is-loading"),e(".description-box__name").html("Error"),e(".description-box__description").html("There's an issue with your Gamertag, make sure it's entered correclty and try again."))}),d.push(o))}),d.reverse(),e.each(d,function(a,t){var s=_.template(e("#match-card").html());"SAMPLE-c7edbf0f-f206-11e4-aa52-24be05e24f7e9"===t.MapId?e.jsonp({url:"https://www.haloapi.com/metadata/h5/metadata/map-variants/"+t.MapVariantId,beforeSend:function(e){e.setRequestHeader("Ocp-Apim-Subscription-Key","ba39bd7104bf4cdf8385f925f2e709a1")},type:"GET",dataType:"json",success:function(a){t.Name=a.name,e("#recent-matches").append(s({match:t}))}}):(t.Name=t.MapName,e("#recent-matches").append(s({match:t}))),e(".page__controls").addClass("is-visible"),e.each(o.player.MedalAwards,function(e,a){var t=a.MedalId,s=t.toString(),i=_.findWhere(c,{id:s});i.count=a.Count,l.push(i)});var i=_.template(e("#medal-list").html()),n="#"+o.id;e(n).append(i({medalsEarned:l}))}),e(".description-box").removeClass("is-visible is-loading"),e(".preloader__background").removeClass("is--loading"),e(".button--load-more").removeClass("is--loading-button")},statusCode:{429:function(){e(".description-box__name").html("Error"),e(".description-box__description").html("Maxmium API calls reached due to traffic. Please try again in 10 seconds."),e(".preloader__background").removeClass("is--loading")}}})}var n="",r="",c="",d=0;e("#gamertag-field").change(function(){""!=e("#gamertag-field").val()&&(n=e("#gamertag-field").val(),r=e("#gamertag-field").val().replace(/ +/g,"+").trim())}),e(".js-button").click(function(t){t.preventDefault(),e(".description-box").addClass("is-visible"),e(".description-box__name").html("Status"),e(".description-box__description").html("Searching for recent matches."),c=e(".select").val(),""===e("#gamertag-field").val()?(e(".description-box__name").html("Error"),e(".description-box__description").html("Gamertag field empty!")):(a(),e(".preloader__background").addClass("is--loading"))}),e(".button--load-more").click(function(t){t.preventDefault(),a(),e(".preloader__background").addClass("is--loading"),e(this).addClass("is--loading-button")}),e(".button--reset").click(function(t){t.preventDefault(),d=0,e(".recent-matches").empty(),e(".page__controls").removeClass("is-visible"),a(),e(".description-box").addClass("is-visible"),e(".description-box__name").html("Status"),e(".description-box__description").html("Searching for recent matches."),e(".preloader__background").addClass("is--loading")}),e("#recent-matches").delegate(".match-card","click",function(){e(this).toggleClass("medals-visible"),e(this).next(".match-card__report").toggleClass("is-visible"),e(".description-box").removeClass("is-visible")}),e("#recent-matches").delegate(".close-button","click",function(){e(this).closest(".match-card__report").removeClass("is-visible"),e(this).closest(".match-card__report").prev(".match-card").removeClass("medals-visible"),e(".description-box").removeClass("is-visible")}),e("#recent-matches").delegate(".medal-list__item","click",function(){var a=e(this).find(".medal-content").attr("data-description"),t=e(this).find(".medal-content").attr("data-name");e(".description-box").addClass("is-visible"),e(".description-box__name").html(t),e(".description-box__description").html(a)}),e(".message-close").click(function(){e(".description-box").removeClass("is-visible")}),e(".link--with-popup").magnificPopup({type:"inline",fixedContentPos:!1,fixedBgPos:!0,overflowY:"auto",closeBtnInside:!0,preloader:!1,midClick:!0,removalDelay:300,mainClass:"my-mfp-zoom-in"})}(jQuery);
