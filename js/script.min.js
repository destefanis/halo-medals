!function(a){"use strict";function i(){if(b=a("#gamertag-field").val(),c=a("#gamertag-field").val().replace(/ +/g,"+").trim(),a(".description-box").addClass("is-visible"),a(".description-box__name").html("Status"),a(".description-box__description").html("Searching for recent matches."),d=a(".select").val(),""===a("#gamertag-field").val())a(".description-box__name").html("Error"),a(".description-box__description").html("Gamertag field empty! Enter your gamertag and try again.");else{j();var g=window.location.href,h=s(g,"gamertag",c);window.history.pushState(h,"Title",h),a(".preloader__background").addClass("is--loading")}jQuery.isEmptyObject(e)&&l(),jQuery.isEmptyObject(f)&&m()}function j(){a.ajax({url:"https://www.haloapi.com/metadata/h5/metadata/maps",beforeSend:function(a){a.setRequestHeader("Ocp-Apim-Subscription-Key","adb9ae6a4e454200ac1d1093af6b29f1")},type:"GET",dataType:"json",success:function(a){k(a)}})}function k(b){a.ajax({url:"https://www.haloapi.com/metadata/h5/metadata/medals",beforeSend:function(a){a.setRequestHeader("Ocp-Apim-Subscription-Key","adb9ae6a4e454200ac1d1093af6b29f1")},type:"GET",dataType:"json",success:function(a){n(b,a)}})}function l(){a.ajax({url:"https://www.haloapi.com/metadata/h5/metadata/weapons",beforeSend:function(a){a.setRequestHeader("Ocp-Apim-Subscription-Key","adb9ae6a4e454200ac1d1093af6b29f1")},type:"GET",dataType:"json",success:function(a){e=a}})}function m(){a.ajax({url:"https://www.haloapi.com/metadata/h5/metadata/csr-designations",beforeSend:function(a){a.setRequestHeader("Ocp-Apim-Subscription-Key","adb9ae6a4e454200ac1d1093af6b29f1")},type:"GET",dataType:"json",success:function(a){f=a},statusCode:{429:function(){a(".description-box__name").html("Error"),a(".description-box__description").html("Maxmium API calls reached due to traffic. Please try again in 10 seconds."),a(".preloader__background").removeClass("is--loading")}}})}function n(b,e){a.ajax({url:"https://www.haloapi.com/stats/h5/players/"+c+"/matches?modes="+d+"&start="+g+"&count=3",beforeSend:function(a){a.setRequestHeader("Ocp-Apim-Subscription-Key","adb9ae6a4e454200ac1d1093af6b29f1")},type:"GET",dataType:"json",success:function(c){o(c,b,e),g+=3,a(".description-box").addClass("is-loading"),a(".description-box__name").html("Success"),a(".description-box__description").html("Recent Matches Found")},statusCode:{429:function(){a(".description-box__name").html("Error"),a(".description-box__description").html("Maxmium API calls reached due to traffic. Please try again in 10 seconds."),a(".preloader__background").removeClass("is--loading")}}}).fail(function(){a(".description-box__name").html("Error"),a(".description-box__description").html("The attempt to fetch recent matches wasn't successful, please try again."),a(".preloader__background").removeClass("is--loading")})}function o(b,c,d){a.each(b.Results,function(){var a=this.Id.MatchId,b=this.Id.GameMode,e=this.MatchCompletedDate.ISO8601Date;1===b?b="arena":4===b&&(b="warzone"),p(a,c,d,b,e)})}function p(c,d,g,h,i){a.ajax({url:"https://www.haloapi.com/stats/h5/"+h+"/matches/"+c,beforeSend:function(a){a.setRequestHeader("Ocp-Apim-Subscription-Key","adb9ae6a4e454200ac1d1093af6b29f1")},type:"GET",dataType:"json",success:function(j){var k=j.MapId,l=g,m=[],n=[];a.each(d,function(){if(k===this.id){j.MapName=this.name,j.MatchType=h,j.MatchImage=this.imageUrl,j.id=c;var d=j.TotalDuration,e=d.replace("PT","").replace("H",":").replace("M","MIN ");j.MatchLength=e.substring(0,e.indexOf("."))+"SEC";var g=i,l=g.substring(0,g.indexOf("T")),n=l.substring(5);j.DateStamp=n.replace(/^0+/,"").replace("-","/"),a.each(j.PlayerStats,function(c,d){var e=this.Player.Gamertag.toLowerCase(),g=b.toLowerCase(),h=(d.TotalSpartanKills+d.TotalAssists)/d.TotalDeaths,i=Math.round(100*h)/100,k=parseFloat(d.TotalGroundPoundDamage+d.TotalWeaponDamage+d.TotalMeleeDamage+d.TotalGrenadeDamage+d.TotalPowerWeaponDamage);d.TotalDamage=k.toFixed();var l=Math.round(d.TotalShotsLanded/d.TotalShotsFired*100);d.TotalAccuracy=l,isNaN(i)?d.KDASpread="N/A":d.KDASpread=Math.round(100*h)/100,null!=d.PreviousCsr&&a.each(f,function(b,c){c.id==d.PreviousCsr.DesignationId&&(d.PreviousRankTitle=c.name,a.each(c.tiers,function(a,b){if(b.id==d.PreviousCsr.Tier)return void(d.PreviousCSRIcon=b.iconImageUrl)}))}),this.Player.Gamertag===b?j.player=this:e===g?j.player=this:(a(".description-box").removeClass("is-loading"),a(".description-box__name").html("Error"),a(".description-box__description").html("There's an issue with your Gamertag, make sure it's entered correclty and try again."))}),m.push(j)}}),a.each(m,function(b,c){var d=_.template(a("#match-card").html()),g=0,h=0;c.player.TotalXPEarned=c.player.XpInfo.TotalXP-c.player.XpInfo.PrevTotalXP,1!=j.player.DNF?a.each(j.TeamStats,function(a,b){b.Score>g&&(g=b.Score,h=b.TeamId,j.player.TeamId===h?j.player.MatchStatus="Victory":j.player.MatchStatus="Defeat")}):j.player.MatchStatus="DNF",a.each(e,function(a,b){if(b.id==c.player.WeaponWithMostKills.WeaponId.StockId)return c.player.WeaponWithMostKills.WeaponName=b.name,c.player.WeaponWithMostKills.WeaponURL=b.smallIconImageUrl,!1}),null!=c.player.CurrentCsr&&a.each(f,function(b,d){d.id==c.player.CurrentCsr.DesignationId&&(c.player.CurrentRankTitle=d.name,a.each(d.tiers,function(a,b){b.id==c.player.CurrentCsr.Tier&&(c.player.CurrentCSRIcon=b.iconImageUrl)}))}),a(".page__controls").addClass("is-visible"),a.each(j.player.MedalAwards,function(a,b){var c=b.MedalId,d=c.toString(),e=_.findWhere(l,{id:d});e.count=b.Count,n.push(e)}),c.medalsEarned=n,"c7edbf0f-f206-11e4-aa52-24be05e24f7e"===c.MapId?a.ajax({url:"https://www.haloapi.com/metadata/h5/metadata/map-variants/"+c.MapVariantId,beforeSend:function(a){a.setRequestHeader("Ocp-Apim-Subscription-Key","adb9ae6a4e454200ac1d1093af6b29f1")},type:"GET",dataType:"json",success:function(b){c.Name=b.name,a("#recent-matches").append(d({match:c})),q(c)}}):(c.Name=c.MapName,a("#recent-matches").append(d({match:c}))),"arena"===c.MatchType&&q(c)}),a(".description-box").removeClass("is-visible is-loading"),a(".preloader__background").removeClass("is--loading"),a(".button--load-more").removeClass("is--loading-button")},statusCode:{429:function(){a(".description-box__name").html("Error"),a(".description-box__description").html("Maxmium API calls reached due to traffic. Please try again in 10 seconds."),a(".preloader__background").removeClass("is--loading")}}})}function q(b){var c,d,e,f,g="#report-"+b.id;null===b.player.PreviousCsr&&b.player.MeasurementMatchesLeft>-1?(a(g).find(".progress-stats__number").html(b.player.MeasurementMatchesLeft),a(g).find(".report__header--rank").text("Placement Matches Left:")):6===b.player.CurrentCsr.DesignationId?(a(g+" #previous-rank-circle").addClass("no-graph"),a(g).find(".progress-stats__number").html(b.player.CurrentCsr.Csr),a(g).find(".report__header--rank-title").text(b.player.PreviousCsr.Csr+" "+b.player.CurrentRankTitle)):7===b.player.CurrentCsr.DesignationId?(a(g+" #previous-rank-circle").addClass("no-graph"),a(g).find(".progress-stats__number").html(b.player.CurrentCsr.Rank),a(g).find(".report__header--rank-title").text(b.player.CurrentRankTitle+" "+b.player.PreviousCsr.Rank)):b.player.CurrentCsr.PercentToNextTier<b.player.PreviousCsr.PercentToNextTier&&b.player.CurrentCsr.Tier>b.player.PreviousCsr.Tier?(c=b.player.PreviousCsr.PercentToNextTier/100,d=b.player.CurrentCsr.PercentToNextTier/100,f=3.6*b.player.PreviousCsr.PercentToNextTier,g="#report-"+b.id,a("#report-"+b.id+" #previous-rank-circle").circleProgress({startAngle:-Math.PI/2+.01745*f,emptyFill:"rgba(90, 90, 102, 1)",value:1-c,size:80,thickness:4,fill:{gradient:["#85F7D3","#5DFDCB"]}}),a(g+" #previous-rank-circle").on("circle-animation-end",function(e){a(g).find(".progress-stats__number").html("+"+parseInt(100*(1-c+d))+"%"),a(g).find(".report__header--rank-title").text(b.player.CurrentRankTitle+" "+b.player.PreviousCsr.Tier+" (RANK UP!)")})):b.player.CurrentCsr.PercentToNextTier>b.player.PreviousCsr.PercentToNextTier&&b.player.CurrentCsr.Tier===b.player.PreviousCsr.Tier?(c=b.player.CurrentCsr.PercentToNextTier/100,e=b.player.PreviousCsr.PercentToNextTier/100,f=3.6*b.player.PreviousCsr.PercentToNextTier,a(g+" #previous-rank-circle").circleProgress({startAngle:-Math.PI/2,value:c,emptyFill:"rgba(255, 255, 255, 1)",size:80,thickness:4,fill:{gradient:["#85F7D3","#5DFDCB"]}}),a(g+" #previous-rank-circle").on("circle-animation-end",function(d){a(g).find(".progress-stats__number").html("+"+parseInt(100*(c-e))+"%"),a(g).find(".report__header--rank-title").text(b.player.CurrentRankTitle+" "+b.player.CurrentCsr.Tier)})):b.player.CurrentCsr.PercentToNextTier<b.player.PreviousCsr.PercentToNextTier&&b.player.CurrentCsr.Tier<=b.player.PreviousCsr.Tier?(c=b.player.CurrentCsr.PercentToNextTier/100,e=b.player.PreviousCsr.PercentToNextTier/100,f=3.6*b.player.PreviousCsr.PercentToNextTier,a(g+" #previous-rank-circle").circleProgress({startAngle:-Math.PI/2+.01745*f,value:c,reverse:!0,size:80,thickness:4,fill:{color:"#F06449"}}),a("#report-"+b.id+" #previous-rank-circle").on("circle-animation-end",function(d){a("#report-"+b.id).find(".progress-stats__number").html("-"+parseInt(100*(e-c))+"%"),a(g).find(".report__header--rank-title").text(b.player.CurrentRankTitle+" "+b.player.CurrentCsr.Tier)})):b.player.CurrentCsr.PercentToNextTier>b.player.PreviousCsr.PercentToNextTier&&b.player.CurrentCsr.Tier<b.player.PreviousCsr.Tier&&(c=b.player.CurrentCsr.PercentToNextTier/100,e=b.player.PreviousCsr.PercentToNextTier/100,f=3.6*b.player.PreviousCsr.PercentToNextTier,a("#report-"+b.id+" #previous-rank-circle").circleProgress({startAngle:-Math.PI/2,value:c,size:80,thickness:4,emptyFill:"rgba(240, 100, 73, 1)",fill:{color:"#5A5A66"}}),a("#report-"+b.id+" #previous-rank-circle").on("circle-animation-end",function(d){a("#report-"+b.id).find(".progress-stats__number").html("-"+parseInt(100*(1-c+e))+"%"),a(g).find(".report__header--rank-title").text(b.player.PreviousRankTitle+" "+b.player.PreviousCsr.Tier)}))}function s(a,b,c){var d=new RegExp("\\b("+b+"=).*?(&|$)");return a.search(d)>=0?a.replace(d,"$1"+c+"$2"):a+(a.indexOf("?")>0?"&":"?")+b+"="+c}var b="",c="",d="",e={},f={},g=0;a(".js-button").click(function(a){a.preventDefault(),i()}),a(".input-field").keypress(function(a){if(13==a.which)return i(),!1}),a(".button--load-more").click(function(b){b.preventDefault(),j(),a(".preloader__background").addClass("is--loading"),a(this).addClass("is--loading-button")}),a(".button--reset").click(function(b){b.preventDefault(),g=0,a(".recent-matches").empty(),a(".page__controls").removeClass("is-visible"),j(),a(".description-box").addClass("is-visible"),a(".description-box__name").html("Status"),a(".description-box__description").html("Searching for recent matches."),a(".preloader__background").addClass("is--loading")}),a("#recent-matches").delegate(".match-card","click",function(){a(this).toggleClass("medals-visible"),a(this).next(".match-card__report").toggleClass("is-visible"),a(".description-box").removeClass("is-visible")}),a("#recent-matches").delegate(".close-button","click",function(){a(this).closest(".match-card__report").removeClass("is-visible"),a(this).closest(".match-card__report").prev(".match-card").removeClass("medals-visible"),a(".description-box").removeClass("is-visible")}),a("#recent-matches").delegate(".medal-list__item","click",function(){var b=a(this).find(".medal-content").attr("data-description"),c=a(this).find(".medal-content").attr("data-name");a(".description-box").addClass("is-visible"),a(".description-box__name").html(c),a(".description-box__description").html(b)}),a(".message-close").click(function(){a(".description-box").removeClass("is-visible")}),a(".link--with-popup").magnificPopup({type:"inline",fixedContentPos:!1,fixedBgPos:!0,overflowY:"auto",closeBtnInside:!0,preloader:!1,midClick:!0,removalDelay:300,mainClass:"my-mfp-zoom-in"}),a("#recent-matches").delegate(".detail__list-item","click",function(){a(this).toggleClass("is-visible")}),a("#recent-matches").delegate(".team-list__toggle","click",function(){a(this).hasClass("team--is-visible")?(a(this).toggleClass("team--is-visible"),a(this).text("Show"),a(this).parent().next(".team__table").hide()):(a(this).toggleClass("team--is-visible"),a(this).text("Hide"),a(this).parent().next(".team__table").show())}),window.onload=function(){var b=r("gamertag");if(void 0!=b){var c=b.replace(/\+/g," ");a(".input-field").val(c)}else{if("gamertag"==sessionStorage.getItem("gamertag"))return;var d=sessionStorage.getItem("gamertag");null!==d&&a(".input-field").val(d)}},window.onbeforeunload=function(){sessionStorage.setItem("gamertag",a(".input-field").val())};var r=function(b){var e,f,c=decodeURIComponent(window.location.search.substring(1)),d=c.split("&");for(f=0;f<d.length;f++)if(e=d[f].split("="),e[0]===b)return void 0===e[1]||e[1]}}(jQuery);
